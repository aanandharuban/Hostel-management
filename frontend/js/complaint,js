document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("token");
  if (!token) return location.href = "index.html";

  const complaintForm = document.getElementById("complaintForm");
  const complaintList = document.getElementById("complaintList");

  complaintForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const category = document.getElementById("category").value;
    const message = complaintForm.querySelector("textarea").value.trim();

    const res = await fetch("/api/complaints", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ category, message })
    });

    const data = await res.json();
    if (data.success) {
      complaintForm.reset();
      loadComplaints();
    } else {
      alert("❌ Failed to submit complaint");
    }
  });

  async function loadComplaints() {
    const res = await fetch("/api/complaints", {
      headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    if (data.success) {
      complaintList.innerHTML = "";
      data.complaints.forEach(c => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${c.category}</strong>: ${c.message}<br><em>Status: ${c.status}</em>`;
        li.style.marginBottom = "12px";
        complaintList.appendChild(li);
      });
    }
  }

  loadComplaints();
});

function logout() {
  localStorage.removeItem("token");
}
// Open modal
document.querySelector(".submit-btn").addEventListener("click", () => {
  document.getElementById("complaintModal").style.display = "flex";
});

function closeModal() {
  document.getElementById("complaintModal").style.display = "none";
}

// Submit form
document.getElementById("complaintForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const title = document.getElementById("title").value;
  const category = document.getElementById("category").value;
  const description = document.getElementById("description").value;
  const token = localStorage.getItem("token");

  const res = await fetch("/api/complaints", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ title, category, message: description })
  });

  const data = await res.json();
  if (data.success) {
    alert("✅ Complaint submitted!");
    closeModal();
    location.reload(); // Or refresh list only
  } else {
    alert("❌ Failed to submit complaint.");
  }
});
const modal = document.getElementById("complaintModal");
const openModalBtn = document.getElementById("openModalBtn");

openModalBtn.addEventListener("click", () => {
  modal.style.display = "flex";
});

function closeModal() {
  modal.style.display = "none";
}
window.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.style.display = "none";
  }
});
